<!-- -*- mode: nxml -*- -->
<configure
	xmlns="http://namespaces.zope.org/zope"
	xmlns:zcml="http://namespaces.zope.org/zcml">
	<include package="zope.component" />

	<subscriber handler=".user_policies.dispatch_content_created_to_user_policies" />
	<subscriber handler=".user_policies.dispatch_content_edited_to_user_policies" />

	<subscriber handler=".user_policies.veto_sharing_for_unsigned_coppa_create" />
	<subscriber handler=".user_policies.veto_sharing_for_unsigned_coppa_edit" />

	<subscriber handler=".user_policies.send_email_on_new_account" />
	<subscriber handler=".user_policies.send_consent_request_on_new_coppa_account" />

	<!-- Filter capabilities -->
	<adapter factory=".user_policies.CoppaUserWithoutAgreementCapabilityFilter" />

	<!-- Require specific profile info for Koppa Kids -->
	<!--
		 NOTE: The transition between these two will be a bit rough.
		 We may have to manually copy some information when we change the
		 interfaces.
	-->
	<adapter factory="nti.dataserver.users.user_profile.RestrictedUserProfileWithContactEmailFactory"
			 provides="nti.dataserver.users.interfaces.IRestrictedUserProfileWithContactEmail"
			 for="nti.dataserver.interfaces.ICoppaUserWithoutAgreement" />

	<adapter factory="nti.dataserver.users.user_profile.EmailRequiredUserProfileFactory"
			 provides="nti.dataserver.users.interfaces.IEmailRequiredUserProfile"
			 for="nti.dataserver.interfaces.ICoppaUserWithAgreement" />

	<adapter factory=".site_policies.MathcountsCoppaUserWithoutAgreementUserProfileFactory"
			 provides=".site_policies.IMathcountsCoppaUserWithoutAgreementUserProfile"
			 for=".site_policies.IMathcountsCoppaUserWithoutAgreement" />

	<adapter factory=".site_policies.MathcountsCoppaUserWithAgreementUserProfileFactory"
			 provides=".site_policies.IMathcountsCoppaUserWithAgreementUserProfile"
			 for=".site_policies.IMathcountsCoppaUserWithAgreement" />

	<!--
		 And apparently we've changed our minds and feel that even
		 teachers should not be able to use images.
		 Too bad for them.
		 NOTE: This is wrong in several ways, chiefly that the
		 presumed requirement is now site-based, not just user based,
		 and we cannot express that, so this is definitely a horrible hack.
	-->
	<adapter
		factory="._creatable_mime_object_vocabulary._ImageAndRedactionRestrictedContentObjectFilter"
		for=".site_policies.IMathcountsCoppaUserWithAgreement" />

	<adapter
		factory="._creatable_mime_object_vocabulary._SimpleRestrictedContentObjectFilter"
		for=".site_policies.IMathcountsCoppaUserWithoutAgreement" />

	<adapter
		factory="._creatable_mime_object_vocabulary._ImageAndRedactionRestrictedContentObjectFilter"
		for=".site_policies.IMathcountsUser" />

</configure>
